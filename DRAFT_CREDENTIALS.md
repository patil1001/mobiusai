# Fixed Credentials for Draft Apps

## Overview
All draft apps generated by MobiusAI use **fixed credentials** so they work immediately without user configuration.

## Fixed Credentials (Same for All Drafts)

### 1. NextAuth Configuration
- **NEXTAUTH_URL**: `http://localhost:{PORT}` (dynamic per draft)
- **NEXTAUTH_SECRET**: `mobiusai-draft-secret-key-change-in-production` (fixed)

### 2. Database
- **DATABASE_URL**: `postgresql://mobius:mobius@db:5432/mobius` (shared database)
  - **Note**: All drafts share the same database. Schema conflicts may occur if drafts have different Prisma schemas.

### 3. Google OAuth
- **GOOGLE_CLIENT_ID**: `851887180420-9j9gmnasvkc2jcr6j7bkj6q28qn4peqc.apps.googleusercontent.com`
- **GOOGLE_CLIENT_SECRET**: `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`

### 4. Groq API (AI)
- **GROQ_API_KEY**: Passed from main app's environment
- **GROQ_BASE_URL**: `https://api.groq.com/openai/v1` (fixed)
- **GROQ_MODEL**: `openai/gpt-oss-120b` (fixed)

### 5. Port Assignment
- **PORT**: Unique port per draft (3001, 3002, 3003, ...)
- Ports are mapped automatically based on projectId

## What Gets Fixed in Generated Code

### 1. `.env.local` / `.env.example`
- Automatically created with all fixed credentials
- Port is set correctly per draft

### 2. `package.json`
- Scripts updated to use correct port:
  - `dev: next dev -p {PORT}`
  - `start: next start -p {PORT}`
- Dependencies ensured:
  - `next: ^14.2.3`
  - `react: ^18.3.1`
  - `react-dom: ^18.3.1`
  - `next-auth: ^4.24.7`
  - `@prisma/client: ^5.20.0`

### 3. `next.config.mjs`
- Ensures `output: 'standalone'` for easier deployment

### 4. Code Files
- **No hardcoded credentials**: All code uses `process.env.*` references
- Credentials are injected at build time into `.env.local`

## Files That Need Credentials (Generated Code Must Reference)

Generated code files should reference these via `process.env`:

1. **`app/api/auth/[...nextauth]/route.ts`**:
   - `process.env.NEXTAUTH_URL`
   - `process.env.NEXTAUTH_SECRET`
   - `process.env.GOOGLE_CLIENT_ID`
   - `process.env.GOOGLE_CLIENT_SECRET`
   - `process.env.DATABASE_URL` (for Prisma adapter)

2. **`lib/prisma.ts`** (if Prisma is used):
   - `process.env.DATABASE_URL`

3. **`lib/groq.ts`** (if Groq is used):
   - `process.env.GROQ_API_KEY`
   - `process.env.GROQ_BASE_URL`
   - `process.env.GROQ_MODEL`

4. **`app/layout.tsx`** or **`components/Providers.tsx`**:
   - `process.env.NEXTAUTH_URL` (for callbacks)

## API Endpoints That May Need Configuration

If generated apps use external APIs, they should:
- Use environment variables for API keys
- Have placeholder values in `.env.example`
- The draft builder will inject fixed values if needed

Common APIs that might need keys:
- **Polkadot RPC**: Can use public endpoints (no key needed)
- **IPFS**: Can use public gateways or require key
- **Third-party APIs**: Should use env vars

## Current Limitations

1. **Shared Database**: All drafts use the same PostgreSQL database
   - **Issue**: Schema conflicts if drafts have different Prisma schemas
   - **Solution**: Use separate databases per draft (future enhancement)

2. **Port Conflicts**: Limited to ports 3001-3050
   - **Issue**: Maximum 50 concurrent drafts
   - **Solution**: Use reverse proxy with paths (future enhancement)

3. **Build Time**: Each draft takes 1-3 minutes to build
   - **Issue**: Users wait during build
   - **Solution**: Pre-build templates or use static exports (future enhancement)

## Production Considerations

For production, consider:

1. **Separate Databases**: One database per draft or schema prefixing
2. **Secret Management**: Use proper secret management (Azure Key Vault, AWS Secrets Manager)
3. **Domain Routing**: Use subdomains or paths instead of ports
4. **Build Queue**: Queue builds to avoid resource conflicts
5. **Auto-scaling**: Scale draft servers based on demand

## Testing the Draft

After a draft is generated:
1. Check `.drafts/{projectId}/.env.local` - should have all credentials
2. Check `.drafts/{projectId}/package.json` - should have correct port in scripts
3. Visit `http://localhost:{PORT}` directly or via `/api/draft/{projectId}`
4. Sign-in should work with Google OAuth (using fixed credentials)
5. Database operations should work (if Prisma schema is correct)

## Troubleshooting

**Draft won't start:**
- Check port conflicts: `lsof -i :{PORT}`
- Check build logs in `.drafts/{projectId}/`
- Ensure `.env.local` exists with all required vars

**Authentication fails:**
- Verify `NEXTAUTH_URL` matches the port
- Check Google OAuth credentials are correct
- Ensure NextAuth callback URLs are configured in Google Console

**Database errors:**
- Verify `DATABASE_URL` is correct
- Run Prisma migrations: `cd .drafts/{projectId} && npx prisma migrate dev`
- Check if schema conflicts with other drafts

